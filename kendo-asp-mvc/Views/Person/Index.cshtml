
@{
    ViewBag.Title = "Grid";
}

<div id="example">
    <div id="grid"></div>
</div>

@section scripts {

    <script>
        $(document).ready(function () {

            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: "/person/list",
                        dataType: "json"
                    },
                    update: {
                        url: "/person/update",
                        dataType: "json",
                        type: "POST"
                    },
                    destroy: {
                        url: "/person/destroy",
                        dataType: "json",
                        type: "POST"
                    },
                    create: {
                        url: "/person/create",
                        dataType: "json",
                        type: "POST"
                    },
                },
                batch: false,
                schema: {
                    model: {
                        id: "Id",
                        fields: {
                            Id: { editable: false, nullable: false },
                            Name: { validation: { required: true } },
                            Country: { type: "string", validation: { required: false } },
                            Email: { type: "string", validation: { required: false } }
                        }
                    }
                }
            });

            var grid = $("#grid").kendoGrid({
                dataSource: dataSource,
                autoBind: true,
                height: 550,
                groupable: true,
                sortable: true,
                navigatable: true,
                edit: onEdit,
                editable: {
                    createAt: "bottom",
                    mode: "inline"
                }, 
                toolbar: ["create"],
                columns: [
                    { field: "Id", title: "Id" },
                    { field: "Name", title: "Full Name", width: 240 },
                    { field: "Email", title: "Email" },
                    { field: "Country", title: "Country", width: 150 },
                    { command: ["edit", "destroy"], title: "&nbsp;", width: "250px" }
                ]
            }).data("kendoGrid"); ;

            grid.tbody.on('keydown', function (e) {

                // add new row on tab on the last row
                if ($(e.target).closest('td').is(':last-child') && $(e.target).closest('tr').is(':last-child')) {
                    grid.addRow();
                }
            })

            function onEdit(e) {

                // do not allow more that 5 rows
                if (e.model.isNew() && e.sender.dataSource.total() > 5) {
                    e.sender.cancelRow();
                }

            }
        });
    </script>

}
